<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>我的全功能日曆 App</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .animate-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-[#F9FBFD]">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // 圖示組件相容處理
        const Icon = ({ name, size = 24, className = "" }) => {
            useEffect(() => { lucide.createIcons(); }, [name]);
            return <i data-lucide={name} style={{ width: size, height: size }} className={className}></i>;
        };

        const WEEKDAYS = ['日', '一', '二', '三', '四', '五', '六'];
        const MONTHS = ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'];

        const getLightColor = (hex) => {
            if (!hex.startsWith('#')) return '#F3F4F6';
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgb(${Math.min(255, r + 215)}, ${Math.min(255, g + 215)}, ${Math.min(255, b + 215)})`;
        };

        const App = () => {
            const [currentDate, setCurrentDate] = useState(new Date());
            const [view, setView] = useState('month');
            const [categories, setCategories] = useState([
                { id: 'work', name: '工作項目', color: '#A3C4F3', lightColor: '#EBF2FF' },
                { id: 'draw', name: '畫畫創作', color: '#FDE2E4', lightColor: '#FFF5F6' },
                { id: 'life', name: '生活日常', color: '#CFEFDF', lightColor: '#F0FBF5' },
            ]);
            const [visibleLayers, setVisibleLayers] = useState(['work', 'draw', 'life']);
            const [events, setEvents] = useState([
                { id: '1', title: '每週繪畫課', type: 'draw', isRecurring: true, repeatDays: [1, 3], startDate: '2025-01-01', hasTime: true, time: '14:00' }
            ]);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [formEvent, setFormEvent] = useState({ title: '', date: '', type: 'work' });

            useEffect(() => { lucide.createIcons(); }, [view, isModalOpen]);

            const formatKey = (date) => {
                if (!date) return "";
                const d = new Date(date);
                return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
            };

            const getEventsForDate = (date) => {
                if (!date) return [];
                const dateStr = formatKey(date);
                const dayOfWeek = date.getDay();
                return events.filter(ev => {
                    if (!visibleLayers.includes(ev.type)) return false;
                    if (ev.isRecurring) {
                        return new Date(dateStr) >= new Date(ev.startDate) && ev.repeatDays.includes(dayOfWeek);
                    }
                    return ev.date === dateStr;
                });
            };

            // 月視圖
            const MonthView = () => {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                const firstDay = new Date(year, month, 1).getDay();
                const numDays = new Date(year, month + 1, 0).getDate();
                const days = [];
                for (let i = 0; i < firstDay; i++) days.push(null);
                for (let i = 1; i <= numDays; i++) days.push(new Date(year, month, i));

                return (
                    <div className="grid grid-cols-7 gap-px bg-gray-100 rounded-[32px] overflow-hidden border border-gray-100 shadow-sm animate-in">
                        {WEEKDAYS.map(d => <div key={d} className="bg-white p-3 text-center text-[10px] font-bold text-gray-400 uppercase tracking-widest">{d}</div>)}
                        {days.map((day, i) => {
                            const dayEvents = getEventsForDate(day);
                            const isToday = day && formatKey(day) === formatKey(new Date());
                            return (
                                <div key={i} onClick={() => day && (setCurrentDate(day), setView('day'))} className="bg-white min-h-[110px] p-1">
                                    {day && (
                                        <>
                                            <div className={`text-xs w-7 h-7 flex items-center justify-center rounded-full mx-auto font-black ${isToday ? 'bg-blue-600 text-white shadow-md' : 'text-slate-400'}`}>{day.getDate()}</div>
                                            <div className="space-y-1">
                                                {dayEvents.slice(0, 3).map(ev => (
                                                    <div key={ev.id} className="text-[9px] px-2 py-0.5 rounded-md truncate font-bold" style={{ backgroundColor: categories.find(c => c.id === ev.type)?.lightColor }}>{ev.title}</div>
                                                ))}
                                            </div>
                                        </>
                                    )}
                                </div>
                            );
                        })}
                    </div>
                );
            };

            // 日視圖 (您要的重點功能)
            const DayView = () => {
                const dayEvents = getEventsForDate(currentDate);
                return (
                    <div className="bg-white rounded-[40px] shadow-sm border border-gray-100 p-8 min-h-[500px] animate-in">
                        <div className="flex items-center gap-6 mb-12">
                            <div className="bg-blue-600 text-white w-16 h-16 rounded-[24px] flex flex-col items-center justify-center shadow-xl shadow-blue-100">
                                <span className="text-[10px] font-black uppercase tracking-widest">{WEEKDAYS[currentDate.getDay()]}</span>
                                <span className="text-2xl font-black">{currentDate.getDate()}</span>
                            </div>
                            <div>
                                <h2 className="text-xl font-black text-slate-800">{currentDate.getFullYear()}年 {currentDate.getMonth()+1}月</h2>
                                <p className="text-xs text-gray-400 font-bold uppercase tracking-widest mt-1">{dayEvents.length} 項行程</p>
                            </div>
                        </div>
                        <div className="space-y-6">
                            {dayEvents.map(ev => (
                                <div key={ev.id} className="flex items-center gap-4 p-6 rounded-[28px] border" style={{ backgroundColor: categories.find(c => c.id === ev.type)?.lightColor, borderColor: categories.find(c => c.id === ev.type)?.color }}>
                                    <div className="flex-1 font-black text-slate-700 text-lg">{ev.title}</div>
                                    <Icon name="info" size={18} className="text-gray-300" />
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            return (
                <div className="max-w-md mx-auto min-h-screen pb-32 relative">
                    <header className="p-6 bg-white border-b sticky top-0 z-40 flex justify-between items-center">
                        <h1 className="text-2xl font-black text-slate-800">{currentDate.getFullYear()}年 {MONTHS[currentDate.getMonth()]}</h1>
                        <div className="flex bg-gray-100 p-1 rounded-2xl">
                            <button onClick={() => setView('month')} className={`p-2.5 rounded-xl ${view === 'month' ? 'bg-white shadow-lg text-blue-600' : 'text-gray-400'}`}><Icon name="calendar" size={16}/></button>
                            <button onClick={() => setView('day')} className={`p-2.5 rounded-xl ${view === 'day' ? 'bg-white shadow-lg text-blue-600' : 'text-gray-400'}`}><Icon name="calendar-days" size={16}/></button>
                            <button onClick={() => setView('items')} className={`p-2.5 rounded-xl ${view === 'items' ? 'bg-white shadow-lg text-blue-600' : 'text-gray-400'}`}><Icon name="layers" size={16}/></button>
                        </div>
                    </header>
                    <main className="p-5">{view === 'month' ? <MonthView /> : view === 'day' ? <DayView /> : <div className="p-10 text-center font-black">類別管理已就緒</div>}</main>
                    
                    <div className="fixed bottom-10 left-1/2 -translate-x-1/2 w-[90%] max-w-[360px] bg-slate-900 shadow-2xl text-white p-3 rounded-[40px] flex justify-between items-center z-50">
                        <div className="flex items-center gap-4 pl-6"><Icon name="clock" size={20} className="text-blue-400" /><span className="text-sm font-black">{formatKey(currentDate)}</span></div>
                        <button onClick={() => { setFormEvent({ title: '', date: formatKey(currentDate), type: 'work' }); setIsModalOpen(true); }} className="bg-blue-600 w-14 h-14 rounded-[28px] flex items-center justify-center shadow-xl shadow-blue-500/40 active:scale-95 transition-all"><Icon name="plus" size={28} /></button>
                    </div>

                    {isModalOpen && (
                        <div className="fixed inset-0 z-[60] flex items-end justify-center bg-slate-900/60 backdrop-blur-md animate-in">
                            <div className="bg-white w-full max-w-md rounded-t-[56px] p-10 shadow-2xl">
                                <h2 className="text-2xl font-black text-slate-800 mb-8">規劃行程</h2>
                                <input type="text" placeholder="行程名稱" className="w-full bg-gray-50 p-6 rounded-2xl text-xl font-black mb-6 outline-none" onChange={e => setFormEvent({...formEvent, title: e.target.value})} />
                                <button onClick={() => { setEvents([...events, { ...formEvent, id: Date.now().toString(), startDate: formEvent.date }]); setIsModalOpen(false); }} className="w-full bg-blue-600 text-white py-6 rounded-[28px] font-black text-xl">確認新增</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
